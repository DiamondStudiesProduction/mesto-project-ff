(()=>{"use strict";var t=document.querySelector("#card-template").content;function e(e,n,o,c,i,a,u,s){var l=t.querySelector(".card").cloneNode(!0);l.querySelector(".card__title").textContent=e.name,l.setAttribute("id","".concat(e._id));var p=l.querySelector(".card__image"),d=l.querySelector(".card__like-button"),f=l.querySelector(".card__like-number"),_=l.querySelector(".card__delete-button");return f.textContent=e.likes.length,p.setAttribute("src",e.link),p.setAttribute("alt",e.name),u&&u(e.likes,s,d),a?_.addEventListener("click",(function(){i(e._id).then((function(t){t&&a(l)})).catch((function(t){console.log(t)}))})):_.style.display="none",p.addEventListener("click",(function(t){n(t)})),d.addEventListener("click",(function(t){t.target.classList.contains("card__like-button_is-active")?r(c,l,f,t.target):r(o,l,f,t.target)})),l}function n(t){t.remove()}function o(t,e,n){for(var o in t)t[o]._id===e&&n.classList.add("card__like-button_is-active")}function r(t,e,n,o){t(e.getAttribute("id")).then((function(t){t&&(function(t){t.classList.contains("card__like-button_is-active")?t.classList.remove("card__like-button_is-active"):t.classList.add("card__like-button_is-active")}(o),n.textContent=t.likes.length)})).catch((function(t){console.log(t)}))}function c(t){!function(t){t.classList.remove("popup_is-opened")}(t),document.removeEventListener("click",a),document.removeEventListener("keydown",u)}function i(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",u),document.addEventListener("click",a)}function a(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close"))&&c(t.target.closest(".popup"))}function u(t){"Escape"===t.key&&c(document.querySelector(".popup_is-opened"))}var s=function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},l=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))},p=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){s(t,n,e)})),l(n,o,e)},d="https://nomoreparties.co/v1/wff-cohort-11",f={authorization:"ad072217-ebd0-41b3-9902-d9d3d00fbc15"};function _(t){return fetch("".concat(d,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:f.authorization,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))}function m(t){return fetch("".concat(d,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:f.authorization,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))}function h(t){return fetch("".concat(d,"/cards/").concat(t),{method:"DELETE",headers:{authorization:f.authorization,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var y,b=document.querySelector(".places__list"),S=document.forms["edit-profile"],g=document.forms["new-place"],k=g.elements["place-name"],C=document.forms["edit-avatar"],q=C.elements.link,L=S.elements.name,E=S.elements.description,j=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),z=g.elements.link,x=document.querySelector(".page__content"),P=document.querySelectorAll(".popup"),T=document.querySelector(".popup__image"),w=x.querySelector(".popup_type_edit"),B=x.querySelector(".popup_type_image"),O=x.querySelector(".popup_type_new-card"),D=x.querySelector(".popup_type_edit_avatar"),I=document.querySelector(".profile__image"),M="",N=document.querySelector(".popup__caption"),J={inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__form_input-error_active",inactiveButtonClass:"popup__button_inactive",submitButtonSelector:".popup__button"};function H(t,e){t.append(e)}function U(t){!function(t){var e=t.target.getAttribute("src"),n=t.target.closest(".card").querySelector(".card__title").textContent;T.setAttribute("src",e),T.setAttribute("alt",n),N.textContent=n}(t),i(B)}function V(){L.value=j.textContent,E.value=A.textContent}function $(){k.value="",z.value=""}function F(){V(),$(),q.value=""}function G(t,e){t.textContent=e?"Сохранение...":"Сохранить"}P.forEach((function(t){t.classList.add("popup_is-animated")})),S.addEventListener("submit",(function(t){t.preventDefault();var e,n,o=t.target.querySelector(".popup__button");G(o,!0),(e=L.value,n=E.value,fetch("".concat(d,"/users/me"),{method:"PATCH",headers:{authorization:f.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){t&&(j.textContent=L.value,A.textContent=E.value,c(w))})).catch((function(t){console.log(t)})).finally((function(){G(o,!1)}))})),g.addEventListener("submit",(function(t){t.preventDefault();var o=t.target.querySelector(".popup__button");G(o,!0);var r,i,a={name:k.value,link:z.value,likes:[],_id:""};(r=k.value,i=z.value,fetch("".concat(d,"/cards"),{method:"POST",headers:{authorization:f.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:r,link:i})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t}))).then((function(t){if(t)return a._id=t._id,t})).then((function(){var t;t=e(a,U,m,_,h,n,"",""),b.prepend(t),c(O),$()})).catch((function(t){console.log(t)})).finally((function(){G(o,!1)}))})),C.addEventListener("submit",(function(t){t.preventDefault();var e,n=t.target.querySelector(".popup__button");G(n,!0),(e=q.value,fetch("".concat(d,"/users/me/avatar"),{method:"PATCH",headers:{authorization:f.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))).then((function(t){t&&(I.style.backgroundImage="url(".concat(t.avatar,")"),c(D))})).catch((function(t){console.log(t)})).finally((function(){G(n,!1)}))})),V(),x.querySelector(".profile__edit-button").addEventListener("click",(function(){i(w),p(S,J),F()})),x.querySelector(".profile__add-button").addEventListener("click",(function(){i(O),p(g,J),F()})),I.addEventListener("click",(function(){i(D),p(C,J),F()})),y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__form_input-error_active"},Array.from(document.querySelectorAll(y.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);l(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?s(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),l(n,o,e)}))}))}(t,y)})),Promise.all([fetch("".concat(d,"/users/me"),{headers:{authorization:f.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)})),fetch("".concat(d,"/cards"),{headers:{authorization:f.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))]).then((function(t){var r,c,i=(c=2,function(t){if(Array.isArray(t))return t}(r=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,i,a=[],u=!0,s=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(a.push(o.value),a.length!==e);u=!0);}catch(t){s=!0,r=t}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw r}}return a}}(r,c)||function(t,e){if(t){if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}(r,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=i[0],u=i[1];I.style.backgroundImage="url(".concat(a.avatar,")"),j.textContent=a.name,A.textContent=a.about,M=a._id,u.forEach((function(t){if(t.owner._id===M){var r=e(t,U,m,_,h,n,o,M);H(b,r)}else{var c=e(t,U,m,_,"","",o,M);H(b,c)}}))})).catch((function(t){console.log(t)}))})();