(()=>{"use strict";var t=document.querySelector("#card-template").content;function e(e,n,o,r,c,u,a,s,p){var l=t.querySelector(".card").cloneNode(!0);l.querySelector(".card__title").textContent=e.name,l.setAttribute("id","".concat(e._id));var d=l.querySelector(".card__image"),_=l.querySelector(".card__like-button"),f=l.querySelector(".card__like-number"),m=l.querySelector(".card__delete-button");return f.textContent=e.likes.length,d.setAttribute("src",e.link),d.setAttribute("alt",e.name),s&&s(e.likes,p,_),a?m.addEventListener("click",(function(){a(l),u(e._id)})):m.style.display="none",d.addEventListener("click",(function(t){n(t)})),_.addEventListener("click",(function(t){o(t),t.target.classList.contains("card__like-button_is-active")?i(r,l,f):i(c,l,f)})),l}function n(t){t.remove()}function o(t){t.target.classList.contains("card__like-button_is-active")?t.target.classList.remove("card__like-button_is-active"):t.target.classList.add("card__like-button_is-active")}function r(t,e,n){for(var o in t)t[o]._id===e&&n.classList.add("card__like-button_is-active")}function i(t,e,n){t(e.getAttribute("id")).then((function(t){n.textContent=t.likes.length}))}function c(t){!function(t){t.classList.remove("popup_is-opened")}(t),document.removeEventListener("click",a),document.removeEventListener("keydown",s)}function u(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",s),document.addEventListener("click",a)}function a(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close"))&&c(t.target.closest(".popup"))}function s(t){"Escape"===t.key&&c(document.querySelector(".popup_is-opened"))}var p,l=function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},d=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))},_=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){l(t,n,e)})),d(n,o,e)},f="https://nomoreparties.co/v1/wff-cohort-11",m={authorization:"ad072217-ebd0-41b3-9902-d9d3d00fbc15","Content-Type":"application/json"},v=document.querySelector(".places__list"),y=document.forms["edit-profile"],h=y.elements.name,S=y.elements.description,b=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),k=document.forms["new-place"],q=k.elements["place-name"],g=k.elements.link,E=document.querySelector(".page__content"),L=document.querySelectorAll(".popup"),j=E.querySelector(".popup_type_edit"),z=E.querySelector(".popup_type_image"),A=E.querySelector(".popup_type_new-card"),P=document.forms["edit-avatar"],T=P.elements.link,x=E.querySelector(".popup_type_edit_avatar"),B=document.querySelector(".profile__image"),w="";function D(t,e){t.prepend(e)}function N(t){!function(t){var e=t.target.getAttribute("src");document.querySelector(".popup__image").setAttribute("src",e)}(t),u(z)}function O(){h.value=b.textContent,S.value=C.textContent}function J(){q.value="",g.value=""}function M(){O(),J(),T.value=""}function H(t,e){t.textContent=e?"Сохранение...":"Сохранить"}L.forEach((function(t){t.classList.add("popup_is-animated")})),y.addEventListener("submit",(function(t){t.preventDefault();var e,n,o=t.target.querySelector(".popup__button");H(o,!0),b.textContent=h.value,C.textContent=S.value,(e=h.value,n=S.value,fetch("".concat(f,"/users/me"),{method:"PATCH",headers:{authorization:m.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).finally((function(){H(o,!1)})),c(j)})),k.addEventListener("submit",(function(t){t.preventDefault();var r=t.target.querySelector(".popup__button");H(r,!0);var i={name:q.value,link:g.value,likes:[],_id:""};new Promise((function(t,u){U(q.value,g.value).then((function(t){if(t)return i._id=t._id,t})).then((function(t){if(t){var r=e(i,N,o,G,K,F,n,"","");D(v,r),c(A),J()}})).finally((function(){H(r,!1)}))}))})),P.addEventListener("submit",(function(t){t.preventDefault();var e,n=t.target.querySelector(".popup__button");H(n,!0),(e=T.value,fetch("".concat(f,"/users/me/avatar"),{method:"PATCH",headers:{authorization:m.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))).then((function(t){t&&(B.style.backgroundImage="url(".concat(t.avatar,")"))})).finally((function(){H(n,!1)})),c(x)})),O(),E.querySelector(".profile__edit-button").addEventListener("click",(function(){u(j);var t=document.querySelector(".popup_is-opened");_(t.querySelector(".popup__form"),{inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__form_input-error_active",inactiveButtonClass:"popup__button_inactive",submitButtonSelector:".popup__button"}),M()})),E.querySelector(".profile__add-button").addEventListener("click",(function(){u(A);var t=document.querySelector(".popup_is-opened");_(t.querySelector(".popup__form"),{inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__form_input-error_active",inactiveButtonClass:"popup__button_inactive",submitButtonSelector:".popup__button"}),M()})),B.addEventListener("click",(function(){u(x);var t=document.querySelector(".popup_is-opened");_(t.querySelector(".popup__form"),{inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__form_input-error_active",inactiveButtonClass:"popup__button_inactive",submitButtonSelector:".popup__button"}),M()})),p={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__form_input-error_active"},Array.from(document.querySelectorAll(p.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);d(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?l(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),d(n,o,e)}))}))}(t,p)}));var I=new Promise((function(t,e){return fetch("".concat(f,"/users/me"),{headers:{authorization:m.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){B.style.backgroundImage="url(".concat(t.avatar,")"),b.textContent=t.name,C.textContent=t.about,w=t._id})).catch((function(t){console.log(t)}))})),V=new Promise((function(t,i){return fetch("".concat(f,"/cards"),{headers:{authorization:m.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){t.forEach((function(t){if(t.owner._id===w){var i=e(t,N,o,G,K,F,n,r,w);D(v,i)}else{var c=e(t,N,o,G,K,"","",r,w);D(v,c)}}))})).catch((function(t){console.log(t)}))})),U=function(t,e){return fetch("".concat(f,"/cards"),{method:"POST",headers:{authorization:m.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))};function F(t){fetch("".concat(f,"/cards/").concat(t),{method:"DELETE",headers:{authorization:m.authorization,"Content-Type":"application/json"}})}function G(t){return fetch("".concat(f,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:m.authorization,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))}function K(t){return fetch("".concat(f,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:m.authorization,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))}Promise.all([I,V])})();