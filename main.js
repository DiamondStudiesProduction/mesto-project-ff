(()=>{"use strict";var t=document.querySelector("#card-template").content;function e(e,n,o,r,c,a,u,s,l){var p=t.querySelector(".card").cloneNode(!0);p.querySelector(".card__title").textContent=e.name,p.setAttribute("id","".concat(e._id));var d=p.querySelector(".card__image"),f=p.querySelector(".card__like-button"),_=p.querySelector(".card__like-number"),m=p.querySelector(".card__delete-button");return _.textContent=e.likes.length,d.setAttribute("src",e.link),d.setAttribute("alt",e.name),s&&s(e.likes,l,f),u?m.addEventListener("click",(function(){u(p),a(e._id)})):m.style.display="none",d.addEventListener("click",(function(t){n(t)})),f.addEventListener("click",(function(t){o(t),t.target.classList.contains("card__like-button_is-active")?i(r,p,_):i(c,p,_)})),p}function n(t){t.remove()}function o(t){t.target.classList.contains("card__like-button_is-active")?t.target.classList.remove("card__like-button_is-active"):t.target.classList.add("card__like-button_is-active")}function r(t,e,n){for(var o in t)t[o]._id===e&&n.classList.add("card__like-button_is-active")}function i(t,e,n){t(e.getAttribute("id")).then((function(t){n.textContent=t.likes.length}))}function c(t){!function(t){t.classList.remove("popup_is-opened")}(t),document.removeEventListener("click",u),document.removeEventListener("keydown",s)}function a(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",s),document.addEventListener("click",u)}function u(t){(t.target.classList.contains("popup")||t.target.classList.contains("popup__close"))&&c(t.target.closest(".popup"))}function s(t){"Escape"===t.key&&c(document.querySelector(".popup_is-opened"))}var l=function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},p=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))},d=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){l(t,n,e)})),p(n,o,e)},f="https://nomoreparties.co/v1/wff-cohort-11",_={authorization:"ad072217-ebd0-41b3-9902-d9d3d00fbc15"};function m(t){return fetch("".concat(f,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:_.authorization,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))}function v(t){return fetch("".concat(f,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:_.authorization,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))}function y(t){fetch("".concat(f,"/cards/").concat(t),{method:"DELETE",headers:{authorization:_.authorization,"Content-Type":"application/json"}})}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var b,S=document.querySelector(".places__list"),g=document.forms["edit-profile"],C=document.forms["new-place"],k=C.elements["place-name"],q=document.forms["edit-avatar"],E=q.elements.link,L=g.elements.name,j=g.elements.description,A=document.querySelector(".profile__title"),z=document.querySelector(".profile__description"),x=C.elements.link,T=document.querySelector(".page__content"),B=document.querySelectorAll(".popup"),P=T.querySelector(".popup_type_edit"),w=T.querySelector(".popup_type_image"),O=T.querySelector(".popup_type_new-card"),D=T.querySelector(".popup_type_edit_avatar"),I=document.querySelector(".profile__image"),M="";function N(t,e){t.append(e)}function J(t){!function(t){var e=t.target.getAttribute("src"),n=document.querySelector(".popup__image"),o=t.target.closest(".card").querySelector(".card__title").textContent;n.setAttribute("src",e),n.setAttribute("alt",o),n.closest(".popup__content").querySelector(".popup__caption").textContent=o}(t),a(w)}function H(){L.value=A.textContent,j.value=z.textContent}function U(){k.value="",x.value=""}function V(){H(),U(),E.value=""}function $(t,e){t.textContent=e?"Сохранение...":"Сохранить"}B.forEach((function(t){t.classList.add("popup_is-animated")})),g.addEventListener("submit",(function(t){t.preventDefault();var e,n,o=t.target.querySelector(".popup__button");$(o,!0),(e=L.value,n=j.value,fetch("".concat(f,"/users/me"),{method:"PATCH",headers:{authorization:_.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){t&&(A.textContent=L.value,z.textContent=j.value,c(P))})).catch((function(t){console.log(t)})).finally((function(){$(o,!1)}))})),C.addEventListener("submit",(function(t){t.preventDefault();var r=t.target.querySelector(".popup__button");$(r,!0);var i,a,u={name:k.value,link:x.value,likes:[],_id:""};(i=k.value,a=x.value,fetch("".concat(f,"/cards"),{method:"POST",headers:{authorization:_.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:i,link:a})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t}))).then((function(t){if(t)return u._id=t._id,t})).then((function(){var t;t=e(u,J,o,v,m,y,n,"",""),S.prepend(t),c(O),U()})).catch((function(t){console.log(t)})).finally((function(){$(r,!1)}))})),q.addEventListener("submit",(function(t){t.preventDefault();var e,n=t.target.querySelector(".popup__button");$(n,!0),(e=E.value,fetch("".concat(f,"/users/me/avatar"),{method:"PATCH",headers:{authorization:_.authorization,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))).then((function(t){t&&(I.style.backgroundImage="url(".concat(t.avatar,")"),c(D))})).catch((function(t){console.log(t)})).finally((function(){$(n,!1)}))})),H(),T.querySelector(".profile__edit-button").addEventListener("click",(function(){a(P),d(g,{inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__form_input-error_active",inactiveButtonClass:"popup__button_inactive",submitButtonSelector:".popup__button"}),V()})),T.querySelector(".profile__add-button").addEventListener("click",(function(){a(O),d(C,{inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__form_input-error_active",inactiveButtonClass:"popup__button_inactive",submitButtonSelector:".popup__button"}),V()})),I.addEventListener("click",(function(){a(D),d(q,{inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",errorClass:"popup__form_input-error_active",inactiveButtonClass:"popup__button_inactive",submitButtonSelector:".popup__button"}),V()})),b={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__form_input-error_active"},Array.from(document.querySelectorAll(b.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);p(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?l(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),p(n,o,e)}))}))}(t,b)})),Promise.all([fetch("".concat(f,"/users/me"),{headers:{authorization:_.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)})),fetch("".concat(f,"/cards"),{headers:{authorization:_.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log(t)}))]).then((function(t){var i,c,a=(c=2,function(t){if(Array.isArray(t))return t}(i=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,i,c,a=[],u=!0,s=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=i.call(n)).done)&&(a.push(o.value),a.length!==e);u=!0);}catch(t){s=!0,r=t}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(s)throw r}}return a}}(i,c)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}(i,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=a[0],s=a[1];I.style.backgroundImage="url(".concat(u.avatar,")"),A.textContent=u.name,z.textContent=u.about,M=u._id,s.forEach((function(t){if(t.owner._id===M){var i=e(t,J,o,v,m,y,n,r,M);N(S,i)}else{var c=e(t,J,o,v,m,"","",r,M);N(S,c)}}))})).catch((function(t){console.log(t)}))})();